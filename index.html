<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dino Game</title>
  <style>
    body { margin: 0; overflow: hidden; background: #f5f5f5; }
    canvas { display: block; margin: auto; background: #fff; border: 2px solid #000; touch-action: none; }
  </style>
</head>
<body>
<canvas id="game"></canvas>

<!-- Telegram SDK -->
<script src="https://telegram.org/js/games.js"></script>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Динозавр
let dino = { 
  x:50, 
  y:canvas.height-80, 
  w:40, 
  h:40, 
  vy:0, 
  jumping:false 
};
let gravity = 0.6;
let jumpPower = -12;

// Препятствия
let obstacles = [];
let frame = 0;

// Счёт
let score = 0;
let gameOver = false;

function jump() {
  if (!dino.jumping) {
    dino.vy = jumpPower;
    dino.jumping = true;
  }
}

function update() {
  if (gameOver) return;

  // Физика динозавра
  dino.y += dino.vy;
  dino.vy += gravity;
  if (dino.y >= canvas.height-80) { 
    dino.y = canvas.height-80; 
    dino.jumping = false; 
  }

  // Создание препятствий
  if (frame % 100 === 0) {
    obstacles.push({ x:canvas.width, y:canvas.height-60, w:30, h:60 });
  }
  obstacles.forEach(o => o.x -= Math.max(6, canvas.width/150));

  // Проверка коллизий
  for (let o of obstacles) {
    if (dino.x < o.x + o.w && dino.x + dino.w > o.x &&
        dino.y < o.y + o.h && dino.y + dino.h > o.y) {
      endGame();
    }
  }

  // Увеличение счёта
  score++;
  frame++;
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Динозавр
  ctx.fillStyle = "green";
  ctx.fillRect(dino.x,dino.y,dino.w,dino.h);

  // Препятствия
  ctx.fillStyle = "red";
  obstacles.forEach(o => ctx.fillRect(o.x,o.y,o.w,o.h));

  // Счёт
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 20, 30);

  if (gameOver) {
    ctx.fillStyle="black";
    ctx.font="30px Arial";
    ctx.fillText("Game Over! Score: " + score, canvas.width/2-100, canvas.height/2);
  }
}

function loop() {
  update();
  draw();
  if (!gameOver) requestAnimationFrame(loop);
}

function endGame() {
  gameOver = true;
  // Отправляем результат в Telegram
  if (window.TelegramGameProxy) {
    TelegramGameProxy.postEvent("score", score);
  }
}

// Управление: пробел (ПК) + тап (телефон)
window.addEventListener("keydown", e => { if (e.code==="Space") jump(); });
window.addEventListener("touchstart", () => jump());

loop();
</script>
</body>
</html>
